{% import "_macros/pin-colors.njk" as pinMapColors %}

{% if "Kids" in product.tags %}
  {% set titleHolder = "E.g. Jack's Adventures" %}
  {% set pinHolder = "E.g. Jack's Travels" %}
{% else %}
  {% set titleHolder = "E.g. Mark & Emma's world travels" %}
  {% set pinHolder = "E.g. Alex's Travels" %}
{% endif %}

<form class="product__form" data-product-form="data-product-form">
  <div class="product__field">
    <p class="product__label">1. Choose your map size:</p>
    <div class="product__select-wrapper sizes">
      {% for option in product.options %}
        {% if "No Frame" in option.value %}
          {% set sizeDims = option.value | replace(r/ -No Frame:Â£[0-9]+/, "") %}
          {% set size = sizeDims | replace(r/ \(.+\)/, "") %}
          {% set dims = sizeDims | replace(r/[A-Za-z-]+/, "") | replace("(", "") | replace(")", "") %}
          {% set height = dims | replace(r/x [0-9]+mm/, "") %}
          {% set width = dims | replace(r/[0-9]+ x/, "") | replace("mm", "") %}
          {% set hypo = (height ** 2 + width ** 2) ** 0.5 // 25.4 | string %}
          {% set hypo = hypo + "\"" %}
          {% set checked = "" %}
          {% if size === "Small" %}
            {% set checked = "checked" %}
          {% endif %}
          <label class="product__select-radio" for="{{size | lower}}">
            <input {{checked}} type="radio" name="size" id="{{size | lower}}" style="display: none;"/>
            <div style="height: {{height // 10}}px; width: {{width // 10}}px">
              <svg width="24" height="24" aria-hidden="true">
                <use xlink:href="/icons/sprite.svg#chevron"></use>
              </svg>
              <small>{{hypo}}</small>
              <svg width="24" height="24" aria-hidden="true">
                <use xlink:href="/icons/sprite.svg#chevron"></use>
              </svg>
            </div>
            <p>{{size}}
              <small>{{dims}}</small>
            </p>
            <small>&pound;{{option.price // 1}}</small>
            <small class="selected">Selected</small>
          </label>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div class="product__field">
    <p class="product__label">2. Choose your frame:</p>
    <div class="product__select-wrapper frames">
      <label class="product__select-radio" for="frameless">
        <input checked type="radio" name="frame" id="frameless" style="display: none;"/>
        <div></div>
        <p>Frameless</p>
        <small>+&pound;0</small>
        <small class="selected">Selected</small>
      </label>
      <label class="product__select-radio" for="black">
        <input type="radio" name="frame" id="black" style="display: none;"/>
        <div><div class="black"></div></div>
        <p>Black</p>
        <small>+&pound;35</small>
        <small class="selected">Selected</small>
      </label>
      <label class="product__select-radio" for="white">
        <input type="radio" name="frame" id="white" style="display: none;"/>
        <div><div class="white"></div></div>
        <p>White</p>
        <small>+&pound;35</small>
        <small class="selected">Selected</small>
      </label>
    </div>
  </div>

  <div class="product__personalisation">
    <h2 class="product__personalisation-title">Personalisation</h2>
    <p class="product__body">Preview your personalised map key before you buy.</p>

    <div class="product__field">
      <label for="map-title" class="product__label">Give your map a title</label>
      <input type="text" name="title" class="product__input" minlength="3" maxlength="36" placeholder="{{titleHolder}}" id="map-title" data-product-map-title="data-product-map-title" required="required">
    </div>

    <p class="product__label">Key text</p>

    <div class="product__radios">
      <label class="product__radio" for="map-key-no">
        <input class="product__radio-input" type="radio" id="map-key-no" name="show key text" value="no" data-map-key="data-map-key">
        No
      </label>

      <label class="product__radio" for="map-key-yes">
        <input class="product__radio-input" type="radio" id="map-key-yes" name="show key text" value="yes" checked="checked" data-map-key="data-map-key">
        Yes
      </label>
    </div>

    <p class="product__label">Select your pin colours</p>

    <div class="pin-colors pin-colors--key-text" data-pin-colors="data-pin-colors">
      {{pinMapColors.pinColors("1", true, pinHolder )}}
      {{pinMapColors.pinColors("2")}}
      {{pinMapColors.pinColors("3")}}
      {{pinMapColors.pinColors("4")}}
      {{pinMapColors.pinColors("5")}}
      {{pinMapColors.pinColors("6")}}
    </div>

    <button type="submit" class="product__button" data-product-submit="data-product-submit">Preview &amp; Add To Basket</button>
  </div>
</form>
    <style>
      .product__select-wrapper {
        align-items: flex-end;
        display: flex;
        justify-content: space-between;
      }

      .product__select-wrapper label {
        align-items: center;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        position: relative;
        text-align: center;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        -webkit-tap-highlight-color: transparent;
      }

      .product__select-wrapper label input + div {
        align-items: center;
        border: 1px solid var(--color-primary);
        border-radius: 2px;
        box-sizing: border-box;
        display: flex;
        flex-direction: row;
        font-size: 17px;
        justify-content: center;
        margin: auto auto 5px;
        position: relative;
      }

      :root {
        --arrow-distance: -3px;
      }

      .product__select-wrapper label input + div svg {
        position: absolute;
        fill: currentColor;
        height: 1em;
        width: 1em;
      }

      .product__select-wrapper label input + div svg:nth-of-type(1) {
        bottom: var(--arrow-distance);
        left: var(--arrow-distance);
        transform: rotate(135deg);
      }

      .product__select-wrapper label input + div svg:nth-of-type(2) {
        top: var(--arrow-distance);
        transform: rotate(-45deg);
        right: var(--arrow-distance);
      }

      .product__select-wrapper label .selected {
        background-color: var(--color-body);
        border: 0;
        border-radius: 2px;
        box-shadow: 0 0 3px rgba(0,0,0,0.15);
        color: white;
        font-size: 12px;
        font-weight: bold;
        line-height: 1.75;
        padding: 0 4px;

        /* Default hidden */
        opacity: 0;
      }

      .product__select-wrapper label input:checked + div {
        border: 2px solid var(--color-success);
        background-color: #70c0414a;
      }

      .product__select-wrapper label input:checked ~ .selected {
        background-color: var(--color-success);
        opacity: 0.85;
      }

      .product__select-wrapper label p {
        margin-bottom: 3px;
      }

      .product__select-wrapper label small {
        display: block;
      }

      .product__select-wrapper label > small {
        border-top: 1px solid var(--color-border);
        padding-top: 3px;
      }

      .product__select-wrapper.frames label > div {
        background: var(--color-neutral);
        border-color: var(--color-border);
        height: 16vw;
        max-height: 80px;
        width: 24vw;
        max-width: 120px;
      }

      .product__select-wrapper.frames label div div {
        border: 5px solid transparent;
        border-radius: 2px;
        height: 100%;
        width: 100%;
      }

      .product__select-wrapper.frames label div div.black {
        border-color: black;
      }

      .product__select-wrapper.frames label div div.white {
        border-color: white;
      }
    </style>